<p>※<a href="/">グラフに移動</a>※</p>
<!-- 陽性者数グラフ -->
<h3>【使い方】</h3>
<div class="less-indent">
    <p>「<span class="bold">＋</span>」「<span class="bold">－</span>」ボタンまたはドロップダウンリストで、<font class="bold">棒グラフの幅</font>を -4 ～ 4 の範囲で増減できます（0位置での<font class="bold">＋－</font>クリックでリスト範囲が変化します）。</p>
    <p>「&#9664;」「&#9654;」ボタン（「<font class="bold">&#9711;他</font>」の右隣）をクリックすると、ラジオボタンで選択できる道府県を増減したり順序を入れ換えたりできます。（最初は「<font class="bold">&#9711;他</font>」をクリックしてください）</p>
    <p>「<span class="bold">近似曲線</span>」をONにすると、過去の実効再生産数(Rt)の推移から計算した<font class="darkred">Rt推移近似（赤の破線）</font>と<font class="darkgreen">陽性者数移動平均推移近似（緑の破線）</font>を表示します。</p>
    <p>「<span class="bold">推計陽性数</span>」をONにすると、陽性者数の推計値を棒グラフ表示します。</p>
    <p>「<span class="bold">シナリオ設定</span>」をONにすると、Rtの変化シナリオを利用者自身で設定できます。</p>
    <p>「<span class="bold">重症者数</span>」をONにすると、重症者数の推移をグラフ表示します（右軸）。この時「右Y軸最大値」は全都道府県に対する固定最大値の設定となります。</p>
    <p>「<span class="bold">検査陽性率</span>」をONにすると、当日を含む過去7日間における検査陽性率を表示します（10倍表示）。</p>
    <p>「<span class="bold">欠損日補完</span>」をONにすると、陽性者数（または重症者数）の欠損日を前後の数値で按分（または補間）して表示します。</p>
    <p>「<span class="bold">左Ｙ軸最大値</span>」で、都道府県ごとにグラフの左Y軸（陽性者数）の最大値を設定できます。</p>
    <p>「<span class="bold">固定</span>」をONにすると、全都道府県に対して左Y軸の最大値を同一値で固定します。</p>
    <p>「<span class="bold">右Ｙ軸最大値</span>」で、都道府県ごとにグラフの右Y軸（実効再生産数）の最大値を設定できます。</p>
    <p>「<span class="bold">開始月</span>」で、グラフの表示開始年月を設定できます。「自動」の場合は当日から半年以上前で直近のものが選択されます。表示期間は最長で1年間です。</p>
    <p>「<span class="bold">クリックで情報画面</span>」をONにすると、グラフをクリックした場合にのみ情報画面（ツールチップ）が表示されるようになります。</p>
    <p>「<span class="bold">近似曲線を前面</span>」をONにすると、破線で描画される近似曲線を実線よりも前面に表示します。</p>
    <p>「<span class="bold">逆算Rt表示</span>」で、推計陽性数から逆算した実効再生産数をグラフ表示します。推計陽性数の妥当性チェック用。</p>
    <p>「<span class="bold">推計陽性者数 棒グラフの最小幅</span>」で、「推計陽性数」をONにした際の棒グラフの最小幅を設定できます。</p>
    <p>「<a href="/reset">リセット</a>」ページに移動し、「OK」ボタンをクリックすると、すべての利用者設定を初期状態に戻します。</p>
    <p>設定情報はお使いのブラウザが管理しているローカルストレージに保存されます（Cookie等が有効な場合）。</p>
</div>

<p class="normal-margin"></p>
<h3>【説明】</h3>
<div class="less-indent">
    <p>当アプリは、日々の新型コロナウイルス陽性者報告数、簡易実効再生産数(Rt)および検査陽性率をグラフ表示するものです。
       ウイルスに感染しCOVID-19を発症した患者のうちの<a href="/forecast">高齢層の陽性者数や重症者数、死亡者数</a>のグラフを表示するページもあります。</p>
    <p style="margin-top: 10px">
        また、利用者の想定するRt増減シナリオに基づいて、簡単な計算によって算出した近似移動平均と推計陽性者の推移シミュレーションを表示することも可能です。
        ただし、将来の陽性者数がこのグラフの通りに推移することを予測するものではありませんのでご注意ください。</p>
    <p style="margin-top: 10px">
        今後の陽性者数のおおよその増減傾向をあらかじめ把握していただくためのアプリとお考えください。</p>

</div>
<div class="less-indent">
    <p style="margin-top: 10px"><span class="bold">近似曲線</span></p>
    <p>後述の「シナリオ設定」がOFFの場合、ここに表示される値はシステムにより自動的に近似計算されたものとなります。</p>
    <div class="indent20px">
        <p>
            <font class="darkgreen">「基準日」</font>は、近似曲線の表示開始日となります。直近35日間の中で Rt が最大/最小/極大/極小/傾き(正負)最大となる日のうち、
            それを起点として計算した近似Rtおよび近似移動平均が実数に最も適合する日を使用します。
        </p>
        <p><font class="darkgreen">「変化日」</font>は、Rtの増減傾向が変化する日です。この日までは「変化日Rt」を目標として「傾曲度」に従ってRtを変化させていきます。</p>
        <p><font class="darkgreen">「次の目標Rt」</font>は、変化日以降の目標Rtです。この値を目標として「次の傾曲度」に従ってRtを変化させていきます。</p>
        <p>
            <font class="darkred">
                なお、変化日以降、将来期間に入ってからもRtが1を超えて推移している場合は、その後既定の期待減衰率を用いて線形に減衰させています
                （行政介入や人々の行動変容を期待して）。
            </font>
            逆にRtが1未満で推移している場合は、最後の実数Rtの80%を減衰の下限としています。
        </p>
    </div>
    <p>
        上記パラメータを基に計算した近似 Rt から移動平均を逆算し、さらにそれの7日移動平均をとって平滑化して、これを近似移動平均としてグラフ表示します。
        上記説明でも分かるとおり、将来期間におけるRtが1を超えている場合には、将来のRt減衰を期待した「<font class="darkred">期待曲線</font>」と呼ぶべきかもしれません。
    </p>

    <p style="margin-top: 10px"><span class="bold">推計陽性者数表示</span></p>
    <p>
        「推計陽性者数表示」をONにすると、過去3週間における同曜日の増減傾向を近似移動平均に掛け合わせて推計値を算出し、グレーの棒グラフで表示します。
        この推計値は目安程度にお考えください。
    </p>

    <p style="margin-top: 10px"><span class="bold">シナリオ設定</span></p>
    <p>「シナリオ設定」をONにすると、Rtの増減シナリオを利用者が詳細に設定できるようになります。</p>
    <p style="margin-left: 8px">「<span class="bold">2段階設定</span>」では、基準日以降のRtの変化ポイントを2箇所まで設定できます。</p>
    <div class="indent20px">
        <p>各パラメータの初期値はシステム設定値になっています。「RESET」ボタンをクリックすると、各パラメータをシステム設定値で初期化します。</p>
        <p>
            <font class="darkgreen">「基準日」</font>あるいは<font class="darkgreen">「変化日までの日数」</font>（または<font class="darkgreen">「変化日」</font>）を変更すると、
            それに基づいて残りのパラメータが自動的に更新されます（利用者がパラメータを変更していない場合）。
        </p>
        <p>
            基準日から「変化日までの日数」（または「変化日」まで）が経過したところで<font class="darkgreen">「変化日Rt」</font>になるように Rt を減少（または増加）させます。<br />
            <font class="darkgreen">「傾曲度」</font>が0の場合は直線的に減少（増加）させますが、傾曲度が大きくなるにつれて、より深いカーブでRtを減少（増加）させます。<br />
            変化日に達したら、<font class="darkgreen">「次の目標Rt」</font>に向けて再び減少（または増加）を始めます。ここで設定する<font class="darkgreen">「次の傾曲度」</font>は次の目標値に達するまでの日数に影響します。
            傾曲度が大きいほど、目標値に達する日数が増えます。
        </p>
        <p>
            <font class="darkgreen">「イベント」</font>をクリックすると、都道府県別に、グラフの特定日付に対する注釈（イベント）を入力することができます。<br />
            「イベント」エリアに「日付:文言」のカンマ区切りで入力してください。通常入力されたイベントはシステムイベントとマージされますが、先頭に ! を付けるとシステムイベントが無視されます。
            日付、コロン、カンマ、感嘆符は半角文字で入力する必要があります。
        </p>
        <p>
            <font class="darkgreen">「Rt期待減衰率」</font>を0より大きな値にすると、変化日以降、将来期間に入ってからもRtが1を超えて推移している場合は、この減衰率に従ってRtを線形に減衰させます。
            （テキストボックスを空にしてEnterを押すとシステム設定値に戻ります）
        </p>
        <p>
            <font class="darkgreen">「Rt極値検出期間」</font>は、基準日の候補となる極大値/極小値を検出する際の局所期間の日数を設定します。候補日を中央にして候補日を除いた日数を局所期間とします。
            システム設定では10日となっています（この設定は全都道府県に適用されます）。<br />
            この日数を小さくすると、より小さな増減の波でも局所的な極大値（または極小値）として検出する可能性が高くなります（大きな値にすればその逆）。
        </p>
        <p>
            <font class="darkgreen">「タイムマシン」</font>をクリックすると、過去のグラフの状態を表示したり、未来の陽性者数を入力してそのグラフを表示したりすることができます。<br />
            「入力データ」エリアに0か負の数字（たとえば-2）を入力すると、その数字の日数だけ過去に戻ったグラフを表示します。また直接に戻りたい日付を入力することもできます。<br />
            陽数者数をカンマ区切りで入力すると、それを最新日の翌日以降の陽性者数データ列として取り込んでグラフ表示します。
            厚労省の都道府県別データは1日遅れで更新されるので、報道機関などによる当日の速報値を入力してみるのもよいでしょう。
        </p>
        <p>
            <font class="darkgreen">「RESET」</font>をクリックすると各都道府県ごとのパラメータが全てシステム設定値に戻ります。RESET直後であれば「CANCEL」で元に戻すことができます。
            <font class="darkred">パラメータを個別にシステム設定値に戻したい場合は、テキストボックスを空にしてEnterを押してください。</font>
        </p>
    </div>
    <p style="margin-left: 8px">「<span class="bold">多段階設定</span>」では、基準日以降のRtの変化ポイントを6段階で設定できます。変化ポイント間はRtが線形に推移します。</p>
    <div class="indent20px">
        <p><font class="darkgreen">「基準日」</font>以降、①から⑥までを順に適用していきます。基準日に日数を累加していった日付で、Rtが設定した値になるように推移します。</p>
        <p><font class="darkgreen">「日数」</font>のところを0または負数にすると、そのステップは無効となり使われなくなります。</p>
        <p>リストボックスで、ストレージに保存してある多段階設定をロードすることができます。また<font class="darkgreen">「保存」</font>で現在の設定をストレージに保存することができます(4つまで保存可能)。</p>
        <p>全国の多段階設定の例として、リストボックスから<font class="darkgreen">「設定例」</font>を選択すると、2020年7月～2021年1月にかけての全国Rtと陽性者数移動平均の変化の様子を近似することができます。
        グラフが2020年9月以降から表示されている場合は「開始月」で「2020年6月」を選択してください。また、棒グラフの幅を-3または-4にすると見やすくなります。</p>
        <p>なお「多段階設定」を選択したまま<a href="/forecast">重症者数・死亡者数のグラフ</a>を表示すると、設定した全国Rt変化シナリオに基づいた予測を表示します。</p>
    </div>
    <p style="margin-top: 10px">
        <font class="darkgreen">日付の入力</font>で「年」を省略して「月/日」だけを入力すると、当日から9か月以内であれば当年、その外なら前年または翌年を補完します。
    </p>
    <p style="margin-top: 10px">
        「シナリオ設定」がONの状態で「重症・死亡者」ページに移動すると、「全国」に対して設定されたパラメータを用いた重症者・死亡者数予測も併せて表示します。
    </p>

    <p style="margin-top: 10px"><span class="bold">実効再生産数(Rt)</span></p>
    <p>当ページで表示している実効再生産数は簡易方式で計算したものです。</p>
    <p>
        実効再生産数については、<a href="https://toyokeizai.net/sp/visual/tko/covid19/" target="_blank">東洋経済のサイト</a>の
        「Q. 実効再生産数とは何ですか？」の説明を参照ください。当ページで使用している計算式も、そこで説明されているものを使わせていただいています。
    </p>
    <p>
        この計算式は、西浦先生の資料「<a href="https://github.com/contactmodel/COVID19-Japan-Reff/blob/master/nishiura_Rt%E4%BC%9A%E8%AD%B0_12May2020.pdf" target="_blank">実効再生産数とその周辺</a>」の
        p.29「幾何級数的増殖モデルが教えてくれること」で説明されている式で、「Δt = 7」「μ = 5」として得られる式となっています。
    </p>
    <p>具体的な計算式は下記のようになります。ここで WS_0 は直近7日間の陽性者数の合計、 WS_7 はその前の7日間の陽性者数の合計です。</p>
    <img src="/img/effective_reproduction.png">

    <p style="margin-top: 10px"><span class="bold">重症者数</span></p>
    <p>重症者数は、厚生労働省のオープンデータおよびPDFファイルから取得した値を表示しています。</p>
    <p>東京都については、都基準と国基準の2通りのデータを積み上げ棒グラフで表示しています。表示上は積み上げになっていますが、国基準の棒グラフが都基準のそれの裏に隠れていると思ってください。
       ツールチップには正しい値が表示されるように調整してあります。</p>
    <p>オレンジ色の横線は、国基準でステージIIIと判断する際の閾値を表しています。国基準の棒グラフがこの線を超えるとステージIIIと判断されます。</p>
    <p>
        なお、都基準は「人工呼吸器またはECMOを使用している」こと、国基準は「集中治療室（ICU）等での管理又は人工呼吸器管理が必要」なことが条件のようです。
        詳細については、
        「<a href="https://www.fukushihoken.metro.tokyo.lg.jp/iryo/kansen/zyuusyoubyousyou.html" target="_blank">国の指標によるコロナ療養者数等の状況</a>」や
        「<a href="https://www.fukushihoken.metro.tokyo.lg.jp/iryo/kansen/zyuusyoubyousyou.html" target="_blank">新型コロナウイルス感染症の重症者・病床について</a>」、
        あるいは
        「<a href="https://stopcovid19.metro.tokyo.lg.jp/" target="_blank">都内の最新感染動向</a>」の「モニタリング項目(7) 重症患者数」からたどれる
        「<a href="https://www.bousai.metro.tokyo.lg.jp/_res/projects/default_project/_page_/001/011/435/7kai/202008207.pdf" target="_blank">重症基準について</a>」
        などを参照してください。
    </p>

    <p style="margin-top: 10px"><span class="bold">検査陽性率</span></p>
    <p>検査陽性率は、基本的に当日を含む過去7日間の積算陽性者数を積算検査人数で割った値となります。グラフには10倍した値として表示しています。</p>
    <p>積算検査人数が前日から変化しない場合、すなわち当日の検査人数が 0 の場合は、前日の陽性率を引き継ぎます。</p>
    <p>積算検数人数の妥当性を高めるため、積算期間中に日別検査人数が0より多くなる日を2日以上含むように積算開始日を遡って計算することがあります（積算期間が7日を超えることがある）。
       積算検査人数の変化しない日が続いた後は、陽性率が実態とは乖離した値となる傾向があることにご留意ください。</p>
    <p>また元の厚労省のデータに誤記と思われる値がある場合もあります。あまりにもかけ離れた値になっている場合は、チャートを脳内補正してください。</p>

    <p style="margin-top: 10px"><span class="bold">欠損日の扱い</span></p>
    <p>いくつかの自治体で、報告が遅れるか、あるいは厚労省における集計が間に合わず、新規陽性者数が0になっている日があります（以下、欠損日）。
       欠損日の陽性者数を0として Rt を計算すると値が変動が激しくなるおそれがあるので、その前後の陽性者数を按分して欠損日の数値を埋めてから計算するようにしています。
       （移動平均も同様）</p>
    <p>「欠損日補完」をONにすると、欠損日前後の陽性者数を按分した数値で表示します。重症者数の欠損日はその前後の数値から補間して表示します。</p>
    <p>なお、比較的陽性者数の大きな自治体で欠損日が発生した場合、報道機関による速報値で欠損日を補完している場合があります。</p>

    <p style="margin-top: 10px"><span class="bold">利用者設定の全リセット</span></p>
    <p>「<a href="/reset">リセット</a>」ページに移動し、「OK」ボタンをクリックすると、すべての利用者設定を初期状態に戻します。</p>
    <p>アプリのバグなどでグラフ表示ができなくなったような場合にも、これによって回復する可能性があります。</p>
</div>

<p class="normal-margin"></p>
<h3>【注意】</h3>
<div class="less-indent">
    <p>当アプリは利用者の設定情報をブラウザが管理しているローカルストレージに保存します。ブラウザで「Cookieを無効」などに設定していると保存されませんのでご注意ください。</p>
    <p>iPhone 7 以前の機種で Safari を使用している場合、棒グラフの幅を 1 以上にするとグラフ表示が出来なくなる場合があります。</p>
    <p>当アプリの仕様は予告なく変更されます。また予告なく再起動されます。</p>
</div>

<p class="normal-margin"></p>
<h3>【データソース】</h3>
<div class="less-indent">
    <p>全国 = <a href="https://www.mhlw.go.jp/stf/covid-19/open-data.html" target="_blank">厚生労働省 オープンデータ(陽性者数)</a></p>
    <p>東京 = <a href="https://catalog.data.metro.tokyo.lg.jp/dataset/t000010d0000000068/resource/c2d997db-1450-43fa-8037-ebb11ec28d4c" target="_blank">東京都_新型コロナウイルス陽性患者発表詳細</a></p>
    <p>各道府県 = 厚生労働省の「<a href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000121431_00086.html" target="_blank">発生状況</a>」ページからたどれる
    【別紙１】「各都道府県の検査陽性者の状況（空港・海港検疫、チャーター便案件を除く国内事例）」PDF資料（<a href="https://www.mhlw.go.jp/content/10906000/000747891.pdf" target="_blank">例</a>）。
    なお、2020年9月3日,4日,23日分についてはPDFからテキスト抽出ができなかったために、前日の値をコピーして使っています
    （つまり当日分の陽性者数が0とカウントされている；ただし一部自治体については目視による補完あり）。</p>
    <p>また、全国や東京などいくつかの自治体については、当日の報道機関による速報値を追加している場合もあります（これは翌日には厚労省のデータで上書きされます）。</p>
    <p>「国内における都道府県別のPCR検査陽性者数」PDFからのテキスト抽出に関しては、<a href="https://github.com/oktopus1959/camelot-mhlw" target="_blank">こちらのgithubリポジトリ</a>にて管理しています。</p>
    <p>東京都の「国基準重症者数」については、<a href="https://www.fukushihoken.metro.tokyo.lg.jp/iryo/kansen/kunishihyou.html" target="_blank">国の指標によるコロナ療養者数等の状況</a>ページから拾っています。</p>
</div>

<p>※<a href="/">グラフに移動</a>※</p>
