<!-- 陽性者数グラフ -->
<h6>【使い方】</h6>
<div class="less-indent">
    <p>「<span class="bold">＋</span>」「<span class="bold">－</span>」ボタンをクリックすると、棒グラフの幅を増減できます。（注）</p>
    <p>「&#9664;」「&#9654;」ボタンをクリックすると、ラジオボタンで選択できる道府県を増減したり順序を入れ換えたりできます。（最初は「<span class="bold">他</span>」をクリックしてください）</p>
    <p>「<span class="bold">近似曲線</span>」をONにすると、過去の実効再生産数(Rt)の推移から計算した<font class="darkred">Rt推移近似（赤の破線）</font>と<font class="darkgreen">近似陽性者数移動平均（緑の破線）</font>を表示します。</p>
    <p>「<span class="bold">推計陽性数</span>」をONにすると、陽性者数の推計値を棒グラフ表示します。</p>
    <p>「<span class="bold">利用者設定</span>」をONにすると、Rtの変化シナリオを利用者自身で設定できます。</p>
    <p>「<span class="bold">検査陽性率</span>」をONにすると、当日を含む過去7日間における検査陽性率を表示します。「％」をONにすると陽性率を100倍して表示します（OFFの場合は10倍表示）。</p>
    <p>「<span class="bold">左Ｙ軸最大値</span>」で、都道府県ごとにグラフの左Y軸（陽性者数）の最大値を設定できます。「下限」をONにして「≧N」を選択すると、全都道府県に対して左Y軸最大値の下限をNに設定します。</p>
    <p>「<span class="bold">右Ｙ軸最大値</span>」で、都道府県ごとにグラフの右Y軸（実効再生産数）の最大値を設定できます。</p>
    <p>「<span class="bold">クリックで情報画面</span>」をONにすると、グラフをクリックした場合にのみ情報画面（ツールチップ）が表示されるようになります。</p>
    <p>「<span class="bold">近似曲線を前面</span>」をONにすると、破線で描画される近似曲線を実線よりも前面に表示します。</p>
    <p>「<span class="bold">推計陽性者数 棒グラフの最小幅</span>」で、「推計陽性数」をONにした際の棒グラフの最小幅を設定できます。</p>
    <p>「<span class="bold">開始月</span>」で、グラフの表示開始年月を設定できます。表示期間は最長で1年間です。</p>
    <p>「<a href="/reset">リセット</a>」ページに移動し、「OK」ボタンをクリックすると、すべての利用者設定を初期状態に戻します。</p>
    <p>設定情報はお使いのブラウザが管理しているローカルストレージに保存されます。</p>
</div>

<p class="normal-margin"></p>
<h6>【説明】</h6>
<div class="less-indent">
    <p>当アプリは、日々の新型コロナウイルス陽性者報告数および簡易実効再生産数(Rt)をグラフ表示するものです。
       またウイルスに感染しCOVID-19を発症した患者のうちの<a href="/forecast">重症者数および死亡者数</a>のグラフを表示するページもあります。</p>
    <p style="margin-top: 10px">
        また、利用者の想定するRt増減シナリオに基づいて、簡単な計算によって算出した近似移動平均と推計陽性者の推移シミュレーションを表示することも可能です。
        ただし、将来の陽性者数がこのグラフの通りに推移することを保証するものではありませんのでご注意ください。</p>
    <p style="margin-top: 10px">今後の陽性者数のおおよその増減傾向をあらかじめ把握していただくためのアプリとお考えください。</p>

</div>
<div class="less-indent">
    <p style="margin-top: 10px"><span class="bold">近似曲線</span></p>
        <p>後述の「利用者設定」がOFFの場合、ここに表示される値はシステムにより自動的に近似計算されたものとなります。</p>
        <div class="indent20px">
            <p>「基準日」は、近似曲線の表示開始日となります。直近35日間の中で Rt が最大/最小/極大/極小/傾き(正負)最大となる日のうち、
                それを起点として計算した近似Rtおよび近似移動平均が実数に最も適合する日を使用します。</p>
            <p>「変化日」は、Rtの増減傾向が変化する日です。この日までは「変化日Rt」を目標として「屈曲度」に従ってRtを変化させていきます。</p>
            <p>「次の目標Rt」は、変化日以降の目標Rtです。この値を目標として「次の屈曲度」に従ってRtを変化させていきます。</p>
            <p class="darkred">なお、変化日以降、将来期間に入ってからもRtが1を超えて推移している場合は、その後既定の期待減衰率を用いて線形に減衰させています。
            （行政介入や人々の行動変容を期待して）</p>
        </div>
    <p>
        上記パラメータを基に計算した近似 Rt から移動平均を逆算し、さらにそれの7日移動平均をとって平滑化して、これを近似移動平均としてグラフ表示します。
        上記説明でも分かるとおり、将来期間におけるRtが1を超えている場合には、将来のRt減衰を期待した「<font class="darkred">期待曲線</font>」と呼ぶべきかもしれません。
    </p>

    <p style="margin-top: 10px"><span class="bold">推計陽性者数表示</span></p>
        <p>「推計陽性者数表示」をONにすると、過去3週間における同曜日の増減傾向を近似移動平均に掛け合わせて推計値を算出し、グレーの棒グラフで表示します。
            この推計値は目安程度にお考えください。 </p>

    <p style="margin-top: 10px"><span class="bold">利用者設定</span></p>
        <p>「利用者設定」をONにすると、Rtの増減シナリオを利用者が詳細に設定できるようになります。</p>
        <p style="margin-left: 8px">「<span class="bold">2段階設定</span>」では、基準日以降のRtの変化ポイントを2箇所まで設定できます。</p>
        <div class="indent20px">
            <p>各パラメータの初期値はシステム設定値になっています。「RESET」ボタンをクリックすると、各パラメータをシステム設定値で初期化します。</p>
            <p>「基準日」を変更すると、それに基づいて残りのパラメータが自動的に更新されます（利用者がパラメータを変更していない場合）。</p>
            <p>基準日から「変化日までの日数」が経過したところで「変化日Rt」になるように Rt を減少（または増加）させます。<br/>
               「屈曲度」が0の場合は直線的に減少（増加）させますが、屈曲度が大きくなるにつれて、より深いカーブでRtを減少（増加）させます。<br/>
               変化日に達したら、「次の目標Rt」に向けて再び減少（または増加）を始めます。ここで設定する「次の屈曲度」は次の目標値に達するまでの日数に影響します。
               屈曲度が大きいほど、目標値に達する日数が増えます。</p>
            <p><font class="darkred">「イベント」をクリックすると、都道府県別に、グラフの特定日付に対する注釈（イベント）を入力することができます。</font><br />
                「イベント」エリアに「日付:文言」のカンマ区切りで入力してください。日付、コロン、カンマは半角文字で入力する必要があります。
            </p>
            <p>「Rt期待減衰率」を0より大きな値にすると、変化日以降、将来期間に入ってからもRtが1を超えて推移している場合は、この減衰率に従ってRtを線形に減衰させます。
                （テキストボックスを空にしてEnterを押すとシステム設定値に戻ります）</p>
            <p>「Rt極値検出期間」は、基準日の候補となる極大値/極小値を検出する際の局所期間の日数を設定します。候補日を中央にして候補日を除いた日数を局所期間とします。
               システム設定では10日となっています（この設定は全都道府県に適用されます）。<br />
               この日数を小さくすると、より小さな増減の波でも局所的な極大値（または極小値）として検出する可能性が高くなります（大きな値にすればその逆）。</p>
            <p><font class="darkred">「タイムマシン」をクリックすると、過去のグラフの状態を表示したり、未来の陽性者数を入力してそのグラフを表示したりすることができます。</font><br/>
                「入力データ」エリアに0か負の数字（たとえば-2）を入力すると、その数字の日数だけ過去に戻ったグラフを表示します。<br/>
                陽数者数をカンマ区切りで入力すると、それを最新日の翌日以降の陽性者数データ列として取り込んでグラフ表示します。
                厚労省の都道府県別データは1日遅れで更新されるので、報道機関などによる当日の速報値を入力してみるのもよいでしょう。</p>
        </div>
        <p style="margin-left: 8px">「<span class="bold">4段階設定</span>」では、基準日以降のRtの変化ポイントを4箇所まで設定できます。</p>
        <div class="indent20px">
            <p>「日数」のところを0または負数にすると、そのステップは無効となり使われなくなります。変化ポイントが3箇所以下の場合は適当なステップを無効にするとよいでしょう。</p>
            <p>全国の4段階設定の例としては、基準日=2020/7/4, Days1=45, Rt1=0.83, Days2=60, Rt2=1, Days3=26, Rt3=1.4, Days4=20, Rt4=1 と設定すると、
            2020年7月～12月にかけての全国Rtと陽性者数移動平均の変化の様子を近似することができます。</p>
            <p>なお「4段階設定」を選択したまま<a href="/forecast">重症者数・死亡者数のグラフ</a>を表示すると、設定した全国Rt変化シナリオに基づいた予測を表示します。</p>
        </div>
        <p style="margin-top: 10px">
            日付の入力で「年」を省略して「月/日」だけを入力すると、当日から9か月以内であれば当年、その外なら前年または翌年を補完します。</p>
        <p style="margin-top: 10px">
            各設定で「RESET」をクリックすると各都道府県ごとのパラメータが全てシステム設定値に戻ります。RESET直後であれば「CANCEL」で元に戻すことができます。<br/>
            パラメータを個別にシステム設定値に戻したい場合は、テキストボックスを空にしてEnterを押してください。</p>
        <p style="margin-top: 10px">
            「利用者設定」がONの状態で「重症・死亡者」ページに移動すると、設定されたパラメータを用いた重症者・死亡者数予測も併せて表示します。</p>

    <p style="margin-top: 10px"><span class="bold">実効再生産数(Rt)</span></p>
        <p>当ページで表示している実効再生産数は簡易方式で計算したものです。</p>
        <p>実効再生産数については、<a href="https://toyokeizai.net/sp/visual/tko/covid19/" target="_blank">東洋経済のサイト</a>の
        「Q. 実効再生産数とは何ですか？」の説明を参照ください。当ページで使用している計算式も、そこで説明されているものを使わせていただいています。</p>
        <p>この計算式は、西浦先生の資料「<a href="https://github.com/contactmodel/COVID19-Japan-Reff/blob/master/nishiura_Rt%E4%BC%9A%E8%AD%B0_12May2020.pdf" target="_blank">実効再生産数とその周辺</a>」の
        p.29「幾何級数的増殖モデルが教えてくれること」で説明されている式で、「Δt = 7」「μ = 5」として得られる式となっています。</p>

    <p style="margin-top: 10px"><span class="bold">検査陽性率</span></p>
        <p>検査陽性率は、基本的に当日を含む過去7日間の積算陽性者数を積算検査人数で割った値となります。グラフには10倍（「％」の場合は100倍）した値として表示しています。</p>
        <p>積算検査人数が前日から変化しない場合、すなわち当日の検査人数が 0 の場合は、前日の陽性率を引き継ぎます。</p>
        <p>積算検数人数の妥当性を高めるため、積算期間中に日別検査人数が0より多くなる日を2日以上含むように積算開始日を遡って計算することがあります（積算期間が7日を超えることがある）。
           積算検査人数の変化しない日が続いた後は、陽性率が実態とは乖離した値となる傾向があることにご留意ください（あまりにもかけ離れた値になっている場合は、脳内補完してください）。</p>

    <p style="margin-top: 10px"><span class="bold">欠損日の扱い</span></p>
        <p>多くの自治体で（おそらくは）厚労省における集計が間に合わず、新規陽性者数が0になっている日があります（以下、欠損日）。
        欠損日の陽性者数を0として Rt を計算すると値が変動が激しくなるおそれがあるので、その前後の陽性者数を按分して欠損日の数値を埋めてから計算するようにしています。
        （移動平均も同様）</p>
        <p>なお、比較的陽性者数の大きな自治体で欠損日が発生した場合、報道機関による速報値で欠損日を補完している場合があります。</p>

    <p style="margin-top: 10px"><span class="bold">利用者設定の全リセット</span></p>
        <p>「<a href="/reset">リセット</a>」ページに移動し、「OK」ボタンをクリックすると、すべての利用者設定を初期状態に戻します。</p>
        <p>アプリのバグなどでグラフ表示ができなくなったような場合にも、これによって回復する可能性があります。</p>
</div>

<p class="normal-margin"></p>
<h6>【注意】</h6>
<div class="less-indent">
    <p>当アプリは利用者の設定情報をブラウザが管理しているローカルストレージに保存します。ブラウザで「Cookieを無効」などに設定していると保存されませんのでご注意ください。</p>
    <p>iPhone 7 以前の機種で Safari を使用している場合、棒グラフの幅を 1 以上にするとグラフ表示が出来なくなる場合があります。</p>
    <p>当アプリの仕様は予告なく変更されます。また予告なく再起動されます。</p>
</div>

<p class="normal-margin"></p>
<h6>【データソース】</h6>
<div class="less-indent">
    <p>全国 = <a href="https://www.mhlw.go.jp/stf/covid-19/open-data.html" target="_blank">厚生労働省 オープンデータ(陽性者数)</a></p>
    <p>各都道府県 = 厚生労働省の「<a href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000121431_00086.html" target="_blank">発生状況</a>」ページからたどれる
    「国内における都道府県別のPCR検査陽性者数」PDF資料（<a href="https://www.mhlw.go.jp/content/10906000/000721149.pdf" target="_blank">例</a>）。
    なお、2020年9月3日,4日,23日分についてはPDFからテキスト抽出ができなかったために、前日の値をコピーして使っています（つまり当日分の陽性者数が0とカウントされている）。</p>
    <p>また、全国や東京などいくつかの自治体については、報道機関による速報値を追加している場合もあります。</p>
    <p>「国内における都道府県別のPCR検査陽性者数」PDFからのテキスト抽出に関しては、<a href="https://github.com/oktopus1959/camelot-mhlw">githubリポジトリ</a>にて管理しています。</p>
</div>
