# NcovChartBlazorApp
新型コロナウイルスの陽性者数の推移をグラフ表示するWebアプリを、 ASP.NET Core Blazor と
Chart.js を使って実装したものです。もともと、Web アプリの勉強用に開発を始めたものなので、
いろいろと不備な点もありますが、Blazor や Chart.js の使い方のサンプルにもなるかと思い、
公開することにしました。

## Web サイト
このアプリは、下記サイトにて実際に稼動しています。

https://ncov.oktopus59.net/

陽性者数の他、 日本における COVID-19 重症者や死亡者数の予測も下記ページで行っています。

https://ncov.oktopus59.net/forecast/

## データソース
- 日本全国の陽性者数、COVID-19 重症者数・死亡者数については、[厚生労働省のオープンデータ](https://www.mhlw.go.jp/stf/covid-19/open-data.html)
- 各都道府県の陽性者数については、厚生労働省の「[発生状況](https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000121431_00086.html)」ページからたどれる
「国内における都道府県別のPCR検査陽性者数」PDF資料（[例](https://www.mhlw.go.jp/content/10906000/000721149.pdf)）。

## ビルド方法など
ビルドには .NET Core 3.1 が必要になります。

.NET Core のインストールやアプリのビルド方法などについては、下記 Qiita ページを参照してください。

- [ASP.NET Core Blazor と Chart.js で入門する Web アプリ作成 － 導入編：サンプルを動かす](https://qiita.com/okatako/items/171f05dfc36d6b27769d)

なお Visual Studio 2019 用の Solution ファイルも入れてあります。

## データ作成方法

### 陽性者数データ
プロジェクトフォルダで update_data.sh を実行します。

```sh
$ ./update_data.sh --load
```

`--load` オプションを付けると、厚労省のオープンデータ（全国陽性者数）をダウンロードしてからデータの作成を行います。

スクリプトの実行には ruby が必要です。

### 都道府県別データ
新しい日付の都道府県別データを作成するには、以下の手順を実行します。
1. 厚労省サイトで「国内における都道府県別のPCR検査陽性者数」PDFを開く
2. 上記PDFに記述されている日付を確認し、その日付から yyyymmdd.txt というファイル名を生成
3. shell 上で `cat > Data/mhlw_pref/yyyymmdd.txt` を実行
3. 開いているPDFの、「北海道」から「三重県」までをドラッグしてクリップボードにコピーし、実行中の cat に食わせる
4. ^D で終了

以下は実行例です。
```sh
$ cat > Data/mhlw_pref/20210117.txt
北海道 15,818 280,837 5.6% 滋賀 ※5 1,747 47,337 3.7%
青森 ※3 643 11,985 5.4% 京都 6,463 111,064 5.8%
岩手 ※3※4※5 467 16,977 2.8% 大阪 ※3※5 38,095 550,329 6.9%
宮城 ※3※5 2,921 43,870 6.7% 兵庫 ※3※4※5 13,520 170,389 7.9%
秋田 208 5,211 4.0% 奈良 ※5 2,602 58,339 4.5%
山形 443 11,682 3.8% 和歌山 865 19,032 4.5%
福島 ※3 1,448 70,516 2.1% 鳥取 ※3※4 177 29,345 0.6%
茨城 3,812 20,711 18.4% 島根 ※5 235 10,183 2.3%
栃木 ※3※5 3,162 88,759 3.6% 岡山 ※4 2,071 35,839 5.8%
群馬 ※3※5 3,290 63,526 5.2% 広島 ※3 4,358 99,692 4.4%
埼玉 ※4 20,785 378,221 5.5% 山口 ※4 833 35,818 2.3%
千葉 17,318 264,173 6.6% 徳島 ※3 291 17,876 1.6%
東京 ※1 85,470 1,161,971 7.4% 香川 ※5 530 32,139 1.6%
神奈川 33,187 412,964 8.0% 愛媛 811 19,037 4.3%
新潟 ※3※5 767 32,456 2.4% 高知 770 6,309 12.2%
富山 ※3※5 796 26,823 3.0% 福岡 ※3※4※5 12,349 308,566 4.0%
石川 ※3 1,326 35,793 3.7% 佐賀 ※3 765 18,855 4.1%
福井 ※3 447 23,084 1.9% 長崎 1,157 48,964 2.4%
山梨 ※3 816 14,741 5.5% 熊本 2,939 46,061 6.4%
長野 ※3※5 1,989 63,438 3.1% 大分 926 53,935 1.7%
岐阜 ※5 3,507 86,752 4.0% 宮崎 1,475 18,888 7.8%
静岡 ※3※4 3,869 117,236 3.3% 鹿児島 1,357 48,606 2.8%
愛知 ※3※4※5 21,051 257,837 8.2% 沖縄 ※3 6,400 101,010 6.3%
三重 ※3 1,783 35,367 5.0%
^D
```

### 年齢階級別陽性者数データ
重症者数・死亡者数の予測には、 Data/infect_by_ages.txt が必要です。
これは、毎週木曜日あたりに厚労省から発表される「年齢階級別陽性者数」を見て手作業で更新しています。

## 実行方法
簡単に実行したい場合は、 dotnet run を使ってください。

```sh
$ dotnet run --urls "http://0.0.0.0:5000;https://0.0.0.0:5001"
```

上記のように `--urls "http://0.0.0.0:5000;https://0.0.0.0:5001"` オプションを付けて起動すると
localhost 以外からもアクセスできるようになります。

## ライセンスなど
プログラムのソースコードについては完全フリーとします。商用含め、いかなる用途に使用していただいても構いません。
ただし、使用した結果について、作者は一切の責を免れるものとします。

Data/ 配下の

- death_rate.txt
- recover_rate.txt
- serious_rate.txt

については、公開する著作物の一部としてこれらを利用される際は
[Qiitaアカウント(@okatako)](https://qiita.com/okatako)
または [Twitterアカウント(@oktopus59)](https://twitter.com/oktopus59) までご一報ください。

以上

